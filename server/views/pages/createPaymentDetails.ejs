<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
</head>
<body>
    <% include ../partials/header %>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0/js/tempusdominus-bootstrap-4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.0/css/tempusdominus-bootstrap-4.min.css"/>
    <div class="container">
        <form id="createPaymentDetails" name="PayD" class="pl-lg-3 pr-lg-3" action="/payment" method="post">
            <div class="card mt-5 justify-content-center text-center">
                <div class="row">
                    <div class="p-5 text-left m-md-5">
                        <h1 class="font-weight-light mt-3 mb-5">
                            Create Your Payment Details
                        </h1>   
                        <div class="form-body">
                            <form method="post" id="paymentdetails" action="">
                                <div class="form-group">
                                    <fieldset class="form-group">
                                        <label for="cardHolderName">Cardholder Name</label>
                                        <input type="text" id="cardHolderName" name="cardHolderName" class="form-control" placeholder="" required="true">
                                    </fieldset>
                                </div>
                                <div class="form-group">
                                    <fieldset class="form-group">
                                        <label for="cardNumber">Card Number</label>
                                        <input type="text" id="cardNumber" name="cardNumber" class="form-control" placeholder="" required="true">
                                    </fieldset>
                                </div>
                                <div class="form-group">
                                    <fieldset class="form-group">
                                        <label for="securityCode">Security Code</label>
                                        <input type="password" id="securityCode" name="securityCode" class="form-control" placeholder="" required="true">
                                    </fieldset>
                                </div>
                                <div class="form-group">
                                    <fieldset class="form-group">
                                        <label for="expiryDate">Expiry Date</label>
                                        <input type="text" id="expiryDate" name="expiryDate" class="form-control" placeholder="" required="true">
                                    </fieldset>
                                </div>
                                <button type="submit" value="submit" class="btn btn-primary btn-lg">Save</button>
                                <button type="button" class="btn btn-submit btn-lg">
                                    <a href="/profile">Back to my profile</a>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <table class="table mb-5 pb-5">
            <thead>
                <tr>
                <th>Cardholder Name</th>
                <th>Card Number</th>
                <th>Security Code</th>
                <th>Expiry Date</th>
                </tr>
                <% for(var i=0; i < itemList.length; i++){ %>
                <tr class="rowRecord" data-id="<%= itemList[i].id %>">
                    <td>
                    <%= itemList[i].cardHolderName %>
                    </td>
                    <td>
                    <%= itemList[i].cardNumber %>
                    </td>
                    <td>
                    <%= itemList[i].securityCode %>
                    </td>
                    <td>
                    <%= itemList[i].expiryDate %>
                    </td>
                    <td>
                    <input type="button" class="editBtn" value="Edit">
                    <input type="button" class="deleteBtn"  value="Delete">
                    </td>
                </tr>
                <% } %>
            </thead>
        </table>
    </div>
    <script>
        $(".editBtn").click(function () {
            var detail_num = $(this).closest("tr").data('id');
            location.href = "<%=urlPath %>editDetails/"+detail_num;
        });
        $(".deleteBtn").click(function () {
            var detail_num = $(this).closest("tr").data('id');
            $.ajax({
                url: '<%=urlPath%>' + detail_num,
                type: 'DELETE',
                success: function (result) {
                    console.log(result.message);
                    var detailsToRemove = '.rowRecord[data-id=' + detail_num + ']';
                    $(detailsToRemove).remove();
                },
                error: function (result) {
                    alert("Unable to delete payment details.");
                    console.log(result.message);
                }
            });
        });
    </script>
    <% include ../partials/footer %>
</body>
</html>